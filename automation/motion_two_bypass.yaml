  blueprint:
    name: 2 Bewegungsmelder mit Sperre
    description: Licht Ã¼ber Bewegungsmelder schalten mit Sperrtaster 
    domain: automation
    author: Benjamin Roth
    input:
      motion_entity_1:
        name: Bewegungsmelder 1
        selector:
          entity:
            filter:
              - domain: input_boolean
              - device_class: motion
                domain: binary_sensor
      motion_entity_2:
        name: Bewegungsmelder 1
        selector:
          entity:
            filter:
              - domain: input_boolean
              - device_class: motion
                domain: binary_sensor
      lock_entity:
        name: Sperrtaster
        selector:
          entity:
            filter:
              - domain: input_boolean
              - domain: switch
      light_target:
        name: Licht
        selector:
          target:
            entity:
              domain: 
                - light
      no_motion_wait:
        name: Wait time
        description: Time to leave the light on after last motion is detected.
        default: 120
        selector:
          number:
            min: 0
            max: 3600
            unit_of_measurement: seconds

  mode: queued

  triggers:
    - trigger: state
      entity_id:
        - !input lock_entity
      to: "on"
      id: Sperren An
    - trigger: state
      entity_id:
        - !input motion_entity_1
        - !input motion_entity_2
      to: "on"
      id: BM An
    - trigger: state
      entity_id:
        - !input motion_entity_1
        - !input motion_entity_2
      to: "off"
      for:
        hours: 0
        minutes: 0
        seconds: !input no_motion_wait
      id: BM Aus
    - trigger: state
      entity_id:
        - !input lock_entity
      to: "off"
      id: Sperren Aus

  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - Sperren An
                - BM An
          sequence:
            - action: light.turn_on
              metadata: {}
              data: {}
              target: !input light_target
        - conditions:
            - condition: trigger
              id:
                - Sperren Aus
          sequence:
            - action: light.turn_off
              metadata: {}
              data: {}
              target: !input light_target
        - conditions:
            - condition: trigger
              id:
                - BM Aus
            - condition: state
              entity_id: !input motion_entity_1
              state: "off"
              for:
                hours: 0
                minutes: 0
                seconds: !input no_motion_wait
            - condition: state
              entity_id: !input motion_entity_1
              state: "off"
              for:
                hours: 0
                minutes: 0
                seconds: !input no_motion_wait
            - condition: state
              entity_id: !input lock_entity
              state: "off"
          sequence:
            - action: light.turn_off
              metadata: {}
              data: {}
              target: !input light_target
